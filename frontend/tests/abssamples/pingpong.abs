
/*
 * PingPong.abs -- PingPong example
 *
 * An  ABS program. To test core parser.  
 *
 */

data Unit {}
data String {}
data Fut<A> {}


interface Ping {

    Unit init(Pong p)  ;
    String m(String m);
    Unit run()	;
}

interface Pong {

    Unit init(Ping p) ;
    String m(String m);
    Unit run()	;

}

class Ping  implements Ping {
    
    Pong pong ;
    String hello_pong ;

    Unit init(Pong p){
	
	pong = p ; 
	return null ;
   	}


    Unit run(){

      Unit x; 
      Fut<String> reply;
      
      reply = pong!m(hello_pong); 
      await reply? ; 
      x = this!run();
      return null ;
   }

    String m(String msg){
	String reply; 
	if (msg_equals_hello_ping) 
	  reply = thanks_pong ;
	else
	    reply = who_are_you ;
        return reply ;
    }
} 

class Pong implements Pong {

    Ping ping ;
    String hi_ping ;

    Unit init(Ping p){
	
	ping = p ; return null ;
    }

    Unit run(){
      
      Unit x;
      Fut<String> reply;
      
      reply = ping!m(hi_ping); 
      await reply? ; 
      x = this!run();
      return null;
   }

    String m(String msg){
	
	String reply;
	 
	if (msg_equals_hello_pong)  
	  reply = thanks_ping ;
	else
	    reply = who_are_you ;
        return reply ;
    } 

}

{
    Ping ping;
    Pong pong;
    Unit x;
     
    ping = new Ping(); 
    pong = new Pong(); 

    x = ping.init(); 
    x = pong.init(); 
    x = ping!run(); 
    x = pong!run(); 
    return null;
}
